---
import { countTagsByArticles } from '../../lib/tags';
import { Tags } from '../../schemas/ArticleSchema';

import BaseLayout from '../../layouts/BaseLayout.astro';

const tagsWithCount = await countTagsByArticles();
const tagsWithColors: Record<Tags, string> = {
    [Tags.PlatformEngineering]:
        'bg-purple-500 hover:bg-purple-400 border-purple-700 hover:border-purple-500 dark:bg-purple-500 dark:hover:bg-purple-400 dark:border-purple-700 dark:hover:border-purple-500',
    [Tags.Frontend]:
        'bg-pink-500 hover:bg-pink-400 border-pink-700 hover:border-pink-500 dark:bg-pink-500 dark:hover:bg-pink-400 dark:border-pink-700 dark:hover:border-pink-500',
    [Tags.SRE]:
        'bg-indigo-500 hover:bg-indigo-400 border-indigo-700 hover:border-indigo-500 dark:bg-indigo-500 dark:hover:bg-indigo-400 dark:border-indigo-700 dark:hover:border-indigo-500',
    [Tags.Gaming]:
        'bg-lime-500 hover:bg-lime-400 border-lime-700 hover:border-lime-500 dark:bg-lime-500 dark:hover:bg-lime-400 dark:border-lime-700 dark:hover:border-lime-500'
};

const enhancedTags = tagsWithCount.map((tagInfo) => {
    const color =
        tagsWithColors[tagInfo.tag] ||
        'bg-blue-500 hover:bg-blue-400 border-blue-700 hover:border-blue-500 dark:bg-blue-500 dark:hover:bg-blue-400 dark:border-blue-700 dark:hover:border-blue-500';
    return {
        ...tagInfo,
        color: color
    };
});

const title = 'All Tags';
---

<BaseLayout pageTitle={title}>
    <div class="py-8 sm:py-16">
        <div class="mx-auto max-w-7xl px-6 lg:px-8">
            <div class="mx-auto">
                <h2
                    class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl"
                >
                    <p>Tags</p>
                </h2>
                <div class="pt-5">
                    <div class="flex flex-wrap">
                        {
                            enhancedTags.map(
                                ({ tag, tagLink, count, color }) => (
                                    <div class="px-2 py-2">
                                        <a
                                            href={`/tags/${tagLink}`}
                                            title={`View posts with the tag: ${tag}`}
                                            data-astro-prefetch
                                        >
                                            <button
                                                class={`${color} rounded border-b-4 px-4 py-2 font-bold text-white`}
                                            >
                                                {tag} ({count})
                                            </button>
                                        </a>
                                    </div>
                                )
                            )
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</BaseLayout>
